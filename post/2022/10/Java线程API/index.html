<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/img/logo-broccoli.png"><title>绕不过的并发编程--Java线程API | pixel-revolve</title><meta name="description" content="爱编程，爱生活">
    <link rel="modulepreload" href="/assets/app.9fd9aa02.js"><link rel="modulepreload" href="/assets/index.html.c0f0d033.js"><link rel="modulepreload" href="/assets/index.html.3a8d3666.js">
    <link rel="stylesheet" href="/assets/style.2781e754.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar invert"><span><a href="/" class=""><span class="site-name">$ cd /home/</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg></span><span>Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg></span><span>Tags</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"/></svg></span><span>Links</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg></span><span>Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg></span><span>Tags</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"/></svg></span><span>Links</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><div class="show-catalog post-wrapper"><div class="article-header use-image post-header" style="background-image:url(/img/blog_cover/2022/10/绕不过的并发编程--Java线程API.jpg);"><div class="article-header-mask" style="background:rgba(40, 57, 101, .4);"></div><div class="article-header-content"><div class="article-tags"><!--[--><span class="article-tag">并发编程</span><!--]--></div><h1 class="article-title">绕不过的并发编程--Java线程API</h1><p class="article-subtitle">调用API进行并发编程</p><div class="article-icons"><div class="article-icon"><svg class="ov-icon" style="font-size:1.08em;" aria-hidden="true" width="17.28" height="17.28" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"/></svg><span>pixel-revolve</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.08em;" aria-hidden="true" width="17.28" height="17.28" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M400 64h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V160h352v298c0 3.3-2.7 6-6 6z"/></svg><span>2022-10-22</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.08em;" aria-hidden="true" width="17.28" height="17.28" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M17.618 5.968l1.453-1.453 1.414 1.414-1.453 1.453a9 9 0 11-1.414-1.414zM12 20a7 7 0 100-14 7 7 0 000 14zM11 8h2v6h-2V8zM8 1h8v2H8V1z"/></svg><span>26 min</span></div></div></div><!----></div><main class="page post-content"><!--[--><!--]--><div class="theme-gungnir-content"><!--[--><h1 id="简单介绍" tabindex="-1"><a class="header-anchor" href="#简单介绍" aria-hidden="true">#</a> 简单介绍</h1><h2 id="线程上下文切换" tabindex="-1"><a class="header-anchor" href="#线程上下文切换" aria-hidden="true">#</a> 线程上下文切换</h2><blockquote><p>什么是线程上下文切换？</p></blockquote><ul><li><blockquote><p>什么是线程上下文？</p></blockquote><p>线程在执行过程中会有自己的运行条件和状态（也称上下文），比如上文所说到过的程序计数器，虚拟机栈信息等。</p></li><li><blockquote><p>什么时候线程会从占用 CPU 状态中退出？</p></blockquote><ul><li>主动让出 CPU，比如调用了 <code>sleep()</code>, <code>wait()</code> 等。</li><li>时间片用完，因为操作系统要防止一个线程或者进程长时间占用 CPU 导致其他线程或者进程饿死。</li><li>调用了阻塞类型的系统中断，比如请求 IO，线程被阻塞。</li><li>被终止或结束运行</li></ul></li></ul><p>这其中<strong>前三种都会发生线程切换</strong>。</p><p>线程切换意味着**需要保存当前线程的上下文，留待线程下次占用 CPU 的时候恢复现场。并加载下一个将要占用 CPU 的线程上下文。**这就是所谓的「上下文切换」。</p><ul><li><blockquote><p>线程上下文切换的问题</p></blockquote><p>上下文切换是现代操作系统的基本功能，因其每次需要保存信息恢复信息，这将会占用 CPU，内存等系统资源进行处理，也就意味着<strong>效率会有一定损耗，如果频繁切换就会造成整体效率低下。</strong></p></li></ul><h2 id="os中的阻塞和挂起" tabindex="-1"><a class="header-anchor" href="#os中的阻塞和挂起" aria-hidden="true">#</a> OS中的阻塞和挂起</h2><blockquote><p>阻塞和挂起都是进程的状态</p></blockquote><blockquote><p>什么是阻塞？</p></blockquote><p>正在执行的进程由于发生某时间（如I/O请求、申请缓冲区失败等）暂时无法继续执行。</p><p>此时引起进程调度，OS把处理机分配给另一个就绪进程，而让受阻进程处于暂停状态，一般将这种状态称为「阻塞」状态。</p><blockquote><p>什么是挂起？</p></blockquote><p>由于系统和用户的需要引入了「挂起」的操作，<strong>进程被挂起意味着该进程处于静止状态。</strong></p><p>如果进程正在执行，它将暂停执行，若原本处于就绪状态，则该进程此时暂不接受调度。（被挂起进程的描述）</p><blockquote><p>共同点</p></blockquote><ul><li><p>进程都暂停执行</p></li><li><p>进程都释放CPU，即两个过程都会涉及上下文切换</p></li></ul><blockquote><p>不同点</p></blockquote><ul><li><p><strong>对系统资源占用不同</strong></p><p>虽然都释放了CPU，但「阻塞」的进程仍处于内存中</p><p>而「挂起」的进程通过“对换”技术被换出到外存（磁盘）中。</p></li><li><p><strong>发生时机不同</strong></p><p>「阻塞」一般在进程等待资源（IO资源、信号量等）时发生；</p><p>「挂起」是由于用户和系统的需要，例如，终端用户需要暂停程序研究其执行情况或对其进行修改、OS为了提高内存利用率需要将暂时不能运行的进程（处于就绪或阻塞队列的进程）调出到磁盘</p></li><li><p><strong>恢复时机不同</strong></p><p>「阻塞」要在等待的资源得到满足（例如获得了锁）后，才会进入就绪状态，等待被调度而执行；</p><p>被「挂起」的进程由将其挂起的对象（如用户、系统）在时机符合时（调试结束、被调度进程选中需要重新执行）将其主动激活</p></li></ul><blockquote><p>我们为什么要学习「OS中的阻塞和挂起」？这是因为接下来我们要讲的<code>sleep()</code>方法就是一个常见的系统调用，一会的sleep过程的描述中会用到「阻塞」和「挂起」这两个概念。</p></blockquote><h1 id="java线程相关api" tabindex="-1"><a class="header-anchor" href="#java线程相关api" aria-hidden="true">#</a> Java线程相关API</h1><blockquote><p>本章我们会用「鱼鱼」和「摸摸」在公司摸鱼的例子来形象的解释各个API的作用。</p></blockquote><h2 id="thread-sleep" tabindex="-1"><a class="header-anchor" href="#thread-sleep" aria-hidden="true">#</a> Thread.sleep</h2><blockquote><p><code>sleep</code>有什么用？</p></blockquote><p><code>sleep</code>调用后会暂停当前线程并让出CPU的执行时间，但是**<code>sleep</code>不会释放当前持有的对象的锁资源**，到时间后会继续执行。</p><p><code>sleep()</code> 可能会抛出 <code>InterruptedException</code>，因为异常不能跨线程传播回 <code>main()</code> 中，因此必须在本地进行处理。线程中抛出的其它异常也同样需要在本地进行处理。</p><blockquote><p><code>sleep</code>使用</p></blockquote><p>模拟场景：</p><p>「鱼鱼」睡个5秒(<code>sleep(time)</code>)就可以恢复精神，「摸摸」不是很相信，帮他计算时间。</p><p>测试代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testThreadSleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> fish<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;我有点困，睡个5s能让我变得好一点&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;好的我睡了，你自便&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;我睡醒了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> mo<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;好的，为了验证下我来给你计个时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Long</span> startTime<span class="token operator">=</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fish<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Long</span> endTime<span class="token operator">=</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;你睡觉花了&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>endTime<span class="token operator">-</span>startTime<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1000</span><span class="token operator">+</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;摸摸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fish<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mo<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">39.955</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 开始
<span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">39.955</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 我有点困，睡个<span class="token number">5</span>s能让我变得好一点
<span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">39.955</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 好的，为了验证下我来给你计个时
<span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">40.066</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 好的我睡了，你自便
<span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">45.077</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 我睡醒了
<span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">45.079</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 你睡觉花了<span class="token number">5</span>s
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p><code>sleep(0)</code>的作用？</p></blockquote><p>让出CPU，会触发操作系统立刻重新进行一次CPU竞争。</p><p>竞争的结果也许是当前线程仍然获得CPU控制权，也许会换成别的线程获得CPU控制权。</p><p><code>RocketMQ</code>的源码中就出现了<code>sleep(0)</code>这段代码。详细可以看这里：<a href="https://juejin.cn/post/7139741080597037063" target="_blank" rel="noopener noreferrer">没有二十年功力，写不出Thread.sleep(0)这一行“看似无用”的代码！</a></p><p>而且某些大厂面试的时候也是会问这个内容的，理解<code>sleep</code>方法还是很重要的。</p><blockquote><p><code>sleep</code>原理</p></blockquote><p><code>sleep</code>的核心是一个<code>native</code>方法：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>进程、线程或任务（Linux中不区分进程与线程，都称为task）都可以<code>sleep</code>，这会导致它们暂停执行一段时间，直到等待的时间结束才恢复执行或在这段时间内被中断。</p><ul><li><blockquote><p><code>sleep</code>在操作系统中的实现的大概流程</p></blockquote><ul><li><p>「挂起」进程（或线程）并修改其运行状态</p></li><li><p>用<code>sleep()</code>提供的参数来设置一个定时器。</p></li><li><p>当时间结束，定时器会触发，内核收到中断后修改进程（或线程）的运行状态。</p><p>例如线程会被标志为就绪而进入就绪队列等待调度。</p></li></ul></li><li><blockquote><p>Linux的<code>sleep</code>方法</p></blockquote><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token comment">///时钟编程 alarm()</span>
<span class="token keyword">void</span> <span class="token function">wakeUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;please wakeup!!/n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;you have 4 s sleep!/n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">signal</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span>wakeUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//将进程挂起</span>
     <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;good morning!/n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Linux内核的<code>sleep()</code>函数是在挂起原语的基础上利用定时器实现的。</p></li></ul><blockquote><p>可变定时器(variable timer)一般在硬件层面是通过一个固定的时钟和计数器来实现的，每经过一个时钟周期将计数器递减，当计数器的值为0时产生「中断」。内核注册一个定时器后可以在一段时间后收到中断。</p></blockquote><h2 id="wait和notify" tabindex="-1"><a class="header-anchor" href="#wait和notify" aria-hidden="true">#</a> wait和notify</h2><blockquote><p><code>wait</code>和<code>notify</code>有什么用？</p></blockquote><p>调用 <code>wait()</code> 使得<strong>线程等待某个条件满足</strong>，线程在等待时会被挂起，当其他线程的运行使得这个条件满足时，其它线程会调用 <code>notify()</code> 或者 <code>notifyAll()</code> 来唤醒挂起的线程。</p><blockquote><p><code>notify</code>和<code>notifyAll</code>的区别</p></blockquote><p>在讲这两个方法的区别之前我们需要先明确「等待队列」和「阻塞队列」的概念。</p><ul><li><blockquote><p>等待队列和阻塞队列</p></blockquote><p>对于每个对象来说，都有自己的「等待队列」和「阻塞队列」。</p><ul><li><p><strong>等待队列</strong></p><p>线程A调用了某个对象的<code>wait()</code>方法，线程A就会释放该对象的锁后，加入锁对象的「等待队列」。</p><p>「等待队列」中的线程不会去竞争该对象的锁。</p></li><li><p><strong>阻塞队列</strong></p><p>只有获取了对象的锁，线程才能执行对象的 <code>synchronized</code> 代码，<code>wait</code>的 线程A 被 线程B <code>notify</code>后会进入锁对象的「阻塞队列」。</p><p>对象的锁每次只有一个线程可以获得，其他线程只能在「阻塞队列」中等待</p></li></ul></li></ul><p><code>notify</code>方法随机唤醒对象的等待队列中的一个线程，进入阻塞队列；</p><p><code>notifyAll()</code> 唤醒对象的等待队列中的所有线程，进入阻塞队列。</p><blockquote><p><code>wait</code>和<code>notify</code>使用</p></blockquote><p>模拟场景：</p><p>「鱼鱼」和「摸摸」是好朋友，鱼鱼今天在办公室摸鱼，摸鱼(<code>wait</code>)前让摸摸记得老板来的时候要提醒(<code>notify</code>)他。</p><p>测试代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testThreadWait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Object</span> office<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> fish<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>office<span class="token punctuation">)</span><span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;我先摸了，老板来了叫我。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                office<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;老板来了，好好工作！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> mo<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;收到收到&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>office<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;别摸鱼了，老板来了！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            office<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;摸摸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fish<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mo<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">14</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">21.193</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 开始
<span class="token number">14</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">21.193</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 我先摸了，老板来了叫我。
<span class="token number">14</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">21.193</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 收到收到
<span class="token number">14</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">21.197</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 别摸鱼了，老板来了！
<span class="token number">14</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">21.197</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 老板来了，好好工作！
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里叫醒(<code>notify</code>)正在摸鱼(<code>wait</code>)的鱼鱼的条件就是「老板来了」。</p><ul><li><blockquote><p><code>wait</code>，<code>notify</code>适用场景</p></blockquote><p>这样的机制十分适合生产者、消费者模式：</p><p>消费者消费某个资源，而生产者生产该资源。</p><p>当该资源缺失时，消费者调用<code>wait()</code>方法进行自我阻塞，等待生产者的生产；生产者生产完毕后调用<code>notify/notifyAll()</code>唤醒消费者进行消费。</p></li></ul><p>（同样的是<strong>线程为了等待某个条件而等待，条件到了则唤醒</strong>）</p><p>我们可以根据代码实际场景运用<code>wait</code>和<code>notify</code>的同步机制。</p><blockquote><p><code>sleep()</code>方法和<code>wait()</code>方法对比</p></blockquote><ul><li><p><strong>共同点</strong></p><ul><li>两者都可以暂停线程的执行。让线程进入<code>WAITING</code>状态。</li></ul></li><li><p><strong>区别</strong></p><ul><li><p><strong><code>sleep()</code> 方法没有释放锁，而 <code>wait()</code> 方法释放了锁</strong> 。</p><blockquote><p>为什么<code>wait()</code>需要释放锁？</p></blockquote><p>使用 <code>wait()</code> 挂起期间，线程会释放锁。</p><p>这是因为，<strong>如果没有释放锁，那么其它线程就无法进入对象的同步方法或者同步控制块中</strong>，那么就无法执行 <code>notify()</code> 或者 <code>notifyAll()</code> 来唤醒挂起的线程，造成死锁。</p></li><li><p><strong><code>wait()</code> 通常被用于线程间交互/通信</strong>，<code>sleep()</code>通常被用于暂停执行。</p><p>（前一句话可以参考上面「摸摸」和「鱼鱼」的故事）</p></li><li><p><strong><code>wait()</code> 方法被调用后，线程不会自动苏醒</strong>，需要别的线程调用同一个对象上的 <code>notify()</code>或者 <code>notifyAll()</code> 方法。</p><p><code>sleep()</code>方法执行完成后，线程会自动苏醒，或者也可以使用 <code>wait(long timeout)</code> 超时后线程会自动苏醒。</p></li><li><p><code>sleep()</code> 是 <code>Thread</code> 类的静态本地方法，<strong><code>wait()</code> 则是 <code>Object</code> 类的本地方法</strong>。</p><ul><li><blockquote><p>为什么<code>wait()</code>方法不定义在<code>Thread</code>中？</p></blockquote><p><code>wait()</code> 是让获得对象锁的线程实现等待，会自动释放当前线程占有的对象锁。</p><p>每个对象（<code>Object</code>）都拥有对象锁，既然要释放当前线程占有的对象锁并让其进入 <code>WAITING</code> 状态，自然是要操作对应的对象（<code>Object</code>）而非当前的线程（<code>Thread</code>）。</p></li><li><blockquote><p>为什么<code>sleep()</code>方法定义在<code>Thread</code>中？</p></blockquote><p>因为 <code>sleep()</code> 是让当前线程暂停执行，<strong>不涉及到对象类</strong>，也不需要获得对象锁。</p></li></ul></li></ul></li></ul><blockquote><p>为什么<code>wait/notify</code>需要和<code>synchronized</code>一起使用？</p></blockquote><ul><li><p>从程序执行来说：</p><p>无论是 <code>wait</code> 还是 <code>notify</code>，如果不配合 <code>synchronized</code> 一起使用，在程序运行时就会报 <code>IllegalMonitorStateException</code> 非法的监视器状态异常，而且 <code>notify</code> 也不能实现程序的唤醒功能了。</p></li><li><p>从逻辑上来说:</p><p><code>wait</code>是让获得对象锁的线程实现等待，在<code>synchronized</code>块中才能满足充分条件，<code>notify</code>同理。</p></li></ul><h2 id="thread-join" tabindex="-1"><a class="header-anchor" href="#thread-join" aria-hidden="true">#</a> Thread.join</h2><blockquote><p>什么是<code>join</code>方法？</p></blockquote><p><code>join</code>是<code>Thread</code>类的方法，官方的说明是：<code>Waits for this thread to die.</code></p><p>等待调用<code>join</code>的线程的任务执行结束。</p><blockquote><p><code>join</code>有什么用？</p></blockquote><p><code>join</code>方法可以控制线程的执行顺序。</p><p>主要作用就是同步，在线程A中调用了线程B的<code>join</code>方法时，表示只有当线程B执行完毕时，线程A才能继续执行。</p><blockquote><p><code>join</code>使用</p></blockquote><p>模拟场景：</p><p>「鱼鱼」想要叫「摸摸」一起去吃饭，但是摸摸还要搬砖，鱼鱼等待摸摸搬完砖(<code>join</code>)才能一起去吃饭。</p><p>测试代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testThreadJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> mo<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;等我一下，我把这个砖搬完&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;开始搬砖!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;搬完了，去吃饭吧！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;摸摸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> fish<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;什么时候去吃饭？&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;好的，等你&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mo<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待摸摸搬完砖</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;行，去吃饭吧&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fish<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mo<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">6</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">59.170</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 开始
<span class="token number">16</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">59.276</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 什么时候去吃饭？
<span class="token number">16</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">59.276</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 等我一下，我把这个砖搬完
<span class="token number">16</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">59.388</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 好的，等你
<span class="token number">16</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">59.388</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 开始搬砖<span class="token operator">!</span>
<span class="token number">16</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">04.402</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 搬完了，去吃饭吧！
<span class="token number">16</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">04.402</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 行，去吃饭吧
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p><code>join</code>原理</p></blockquote><p><code>join</code>核心源码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> delay <span class="token operator">=</span> millis <span class="token operator">-</span> now<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">wait</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
            now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> base<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>阅读源码我们知道<code>join</code>实际是利用<code>wait</code>方法来实现的</p><p>用上面「鱼鱼」和「摸摸」的例子来解释：</p><p>当线程<code>fish</code>调用线程<code>mo</code>的<code>join</code>方法的时候，<code>fish</code>获取到了<code>mo</code>的对象锁。</p><p>而<code>mo</code>调用自身<code>wait</code>方法进行阻塞，只要当<code>mo</code>结束或者到时间后才会退出，接着唤醒线程<code>fish</code>继续执行。</p><p><code>millis</code>为线程<code>fish</code>等待线程<code>mo</code>最长执行多久（0为永久），<code>join</code>源码中调用<code>wait(0)</code>，所以<code>fish</code>等待直到线程<code>mo</code>执行结束。</p><h2 id="thread-yield" tabindex="-1"><a class="header-anchor" href="#thread-yield" aria-hidden="true">#</a> Thread.yield</h2><blockquote><p>什么是<code>yield</code>？</p></blockquote><p>很多人翻译成「线程让步」，算是很形象了。</p><p>对静态方法 <code>Thread.yield()</code> 的调用声明了当前线程已经完成了生命周期中最重要的部分，可以切换给其它线程来执行。</p><p>该方法只是对线程调度器的一个建议，而且也只是建议具有相同优先级的其它线程可以运行。</p><p>简单来说，调用后当前线程从运行状态变成就绪状态。CPU会在就绪状态的线程中重新选举下一个执行的线程。</p><blockquote><p><code>yield</code>使用</p></blockquote><p>模拟场景：</p><p>有一个需求，但是「鱼鱼」和「摸摸」都不想揽活，于是他们互相推让(<code>yield</code>)。其中「鱼鱼」态度更坚决一些（优先级为5），于是在辩论阶段会争取到更多的话语权。</p><p>测试代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testThreadYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> fish<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;这个需求鱼鱼干不了，摸摸来吧&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fish<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> mo<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;这个需求摸摸干不了，鱼鱼来吧&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;摸摸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fish<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mo<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mo<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.606</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 开始
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求鱼鱼干不了，摸摸来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.718</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.719</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.719</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.719</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.719</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.720</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.720</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.720</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
<span class="token number">11</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">30.721</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 这个需求摸摸干不了，鱼鱼来吧
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>由于鱼鱼的优先级更高，所以在推辞(<code>yield</code>)后还能争抢下一次CPU的时间片分配。最后鱼鱼已经先于摸摸讲完了10次推辞，摸摸只能默默的一个人无力的推辞。</p><h2 id="thread-interrupt" tabindex="-1"><a class="header-anchor" href="#thread-interrupt" aria-hidden="true">#</a> Thread.interrupt</h2><blockquote><p>本章其实需要讲的是<code>interrupt</code>和<code>interrupted</code></p><p>一个线程在正常执行完成后会自动结束，如果在运行过程中发生异常也会提前结束。</p></blockquote><blockquote><p>什么是<code>InterruptedException</code>？</p></blockquote><p>通过调用一个线程的 <code>interrupt</code> 可以通过让线程抛出异常的方式中断该线程。</p><p>如果该线程处于阻塞、限期等待或者无限期等待状态，那么就会<strong>抛出 <code>InterruptedException</code>，从而提前结束该线程。</strong></p><p>但是不能中断 I/O 阻塞和 <code>synchronized </code>锁阻塞。</p><blockquote><p><code>interrupt</code>使用</p></blockquote><p>模拟场景：</p><p>今天「摸摸」休假，「鱼鱼」一个人在公司也想摸鱼睡觉，结果老板来了直接打断（<code>interrupt</code>）了他，导致他不能正常的从睡觉状态切换成工作状态，露出了马脚。</p><p>测试代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testThreadInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> fish<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;白天睡大觉！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;好好工作！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 不被打断鱼鱼就会正常工作</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fish<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;老板来了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fish<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;老板：都异常了，别装了，一会来我办公室&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">16</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">20.010</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 开始
<span class="token number">16</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">20.219</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 白天睡大觉！
<span class="token number">16</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">20.219</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 老板来了
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>InterruptedException</span><span class="token operator">:</span> sleep interrupted
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span><span class="token punctuation">.</span>lambda$testThreadInterrupt$<span class="token function">8</span><span class="token punctuation">(</span><span class="token class-name">TestThreadAPI</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">148</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">748</span><span class="token punctuation">)</span>
<span class="token number">16</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">20.426</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 老板：都异常了，别装了，一会来我办公室
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>什么是<code>interrupted</code>？</p></blockquote><p>只有<code>interrupt</code>的局限性：</p><p>如果一个线程的 <code>run()</code> 方法执行一个无限循环，并且没有执行 <code>sleep()</code> 等会抛出 <code>InterruptedException</code> 的操作，那么调用线程的 <code>interrupt()</code> 方法就无法使线程提前结束。</p><p><code>interrupt</code>和<code>interrupted</code>一般是配合的：</p><p>但是调用 <code>interrupt()</code> 方法会设置线程的「中断标记」，此时调用 <code>interrupted()</code> 方法会返回 <code>true</code>。</p><p>因此可以在循环体中使用 <code>interrupted()</code> 方法来判断线程是否处于中断状态，从而提前结束线程。</p><blockquote><p><code>interrupted</code>使用</p></blockquote><p>模拟场景：</p><p>有了上次睡觉被打断（<code>interrupt</code>）的经验，「鱼鱼」决定通过看一些媒体（不会抛出<code>InterruptedException</code>）的方式摸鱼，但是一旦注意到老板来了（<code>interrupted()==true</code>）就要快速切换成工作状态。</p><p>测试代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testThreadInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> fish<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> media<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;B站&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;知乎&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;微博&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;小红书&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;爱奇艺&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Random</span> random<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 只要没有被打断就摸鱼</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>media<span class="token punctuation">[</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>media<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span>
                      <span class="token operator">+</span><span class="token string">&quot;真好看，嘿嘿...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">%</span><span class="token number">19</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// 防止一直占用CPU</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;老板来了，好好工作！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fish<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;老板来了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fish<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;老板：这次不错嘛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.213</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 开始
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.279</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 爱奇艺真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.279</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> <span class="token class-name">B</span>站真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.279</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 小红书真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.279</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 微博真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.279</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 小红书真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.279</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 小红书真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.280</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 老板来了
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.282</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 老板来了，好好工作！
<span class="token number">16</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">40.342</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 老板：这次不错嘛
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="thread-setdeamon" tabindex="-1"><a class="header-anchor" href="#thread-setdeamon" aria-hidden="true">#</a> Thread.setDeamon</h2><blockquote><p>什么是<code>Deamon</code>？</p></blockquote><p>守护线程是程序运行时在后台提供服务的线程，不属于程序中不可或缺的部分。</p><p>当所有非守护线程结束时，程序也就终止，同时会杀死所有守护线程。</p><p>（<code>main()</code> 属于非守护线程。而垃圾回收器线程就是一种守护线程。）</p><p>在线程启动之前使用 <code>setDaemon()</code> 方法可以将一个线程设置为守护线程。</p><blockquote><p><code>setDeamon</code>使用</p></blockquote><p>模拟场景：</p><p>「摸摸」回来上班了，「鱼鱼」改掉了上班睡觉的习惯而变成了刷各媒体平台了，这一次鱼鱼看的出了神，摸摸害怕鱼鱼翻车，决定自发的提醒他。鱼鱼听到了提醒也决定还是好好工作，刚好就给老板撞上了。多亏了摸摸默默的守护（<code>setDeamon(true)</code>）。</p><p>测试代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSetThreadDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> fish<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> media<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;B站&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;知乎&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;微博&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;小红书&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;爱奇艺&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Random</span> random<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 只要没有被打断就摸鱼</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>media<span class="token punctuation">[</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>media<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span>
                      <span class="token operator">+</span><span class="token string">&quot;真好看，嘿嘿...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;老板来了，好好工作！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> mo<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">6L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;小心点，今天查的严&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fish<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;摸摸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mo<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fish<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mo<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;老板：这次不错嘛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.421</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 开始
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.421</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 爱奇艺真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.425</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 微博真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.425</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 知乎真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.425</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 小红书真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.425</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 知乎真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.426</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 爱奇艺真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.426</span> <span class="token punctuation">[</span>摸摸<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 小心点，今天查的严
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.426</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 知乎真好看，嘿嘿<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.426</span> <span class="token punctuation">[</span>鱼鱼<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 老板来了，好好工作！
<span class="token number">17</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">38.476</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 老板：这次不错嘛
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>解释：</p><p>这里「摸摸」看见了「鱼鱼」摸鱼了6ms就去提醒了鱼鱼，而且过程中鱼鱼并没有释放掉CPU时间片，摸摸也能正常的运行，这是因为摸摸成了守护线程执行在后台（CPU），为用户线程鱼鱼提供服务，不和用户线程争抢时间片，两者算是并行的。</p><h2 id="thread-run" tabindex="-1"><a class="header-anchor" href="#thread-run" aria-hidden="true">#</a> Thread.run</h2><blockquote><p>可以直接调用<code>run</code>方法吗？</p></blockquote><p>这是另一个非常经典的 Java 多线程面试问题，而且在面试中会经常被问到。</p><p><code>new</code> 一个 <code>Thread</code>，线程进入了新建状态。</p><p>调用 <code>start()</code>方法，会启动一个线程并使线程进入了就绪状态，当分配到时间片后就可以开始运行了。<code>start()</code> 会执行线程的相应准备工作，然后自动执行 <code>run()</code> 方法的内容，<strong>这是真正的多线程工作</strong>。</p><p>但是，<strong>直接执行 <code>run()</code> 方法，会把 <code>run()</code> 方法当成一个 main 线程下的普通方法去执行，并不会在某个线程中执行它，所以这并不是多线程工作。</strong></p><ul><li><blockquote><p>测试</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testThreadRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> fish<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;你好我是鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;鱼鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fish<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>运行结果：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">14</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">35.089</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">DEBUG</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>dyh<span class="token punctuation">.</span></span>TestThreadAPI</span> <span class="token operator">-</span> 你好我是鱼鱼
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>发现执行任务的线程并不是「鱼鱼」而是main线程。</p></li></ul><p><strong>总结： 调用 <code>start()</code> 方法方可启动线程并使线程进入就绪状态，直接执行 <code>run()</code> 方法的话不会以多线程的方式执行。</strong></p><h1 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h1><p>本篇文章我们结合「鱼鱼」和「摸摸」上班摸鱼的例子讲解了Java线程相关 API。</p><p>相信通过本章的学习大家可以对线程 API 形成足够的印象。</p><p>本章参考：</p><ul><li>https://javaguide.cn/java/concurrent/java-concurrent-questions-01.html</li><li>https://juejin.cn/post/6844903520437551111</li><li>https://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&amp;mid=2247484504&amp;idx=1&amp;sn=12e75d9481318659d853335d530e048f</li><li>https://www.jianshu.com/p/74becd7ffcf6</li><li>https://www.jianshu.com/p/8abd8de8aeee</li><li>https://iamxpy.github.io/2017/09/20</li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><!----><!--[--><!--]--><!----></main><ul class="catalog" style="top:0px;"><li class="level-2 toc-link-线程上下文切换">线程上下文切换</li><li class="level-2 toc-link-os中的阻塞和挂起">OS中的阻塞和挂起</li><li class="level-2 toc-link-thread-sleep">Thread.sleep</li><li class="level-2 toc-link-wait和notify">wait和notify</li><li class="level-2 toc-link-thread-join">Thread.join</li><li class="level-2 toc-link-thread-yield">Thread.yield</li><li class="level-2 toc-link-thread-interrupt">Thread.interrupt</li><li class="level-2 toc-link-thread-setdeamon">Thread.setDeamon</li><li class="level-2 toc-link-thread-run">Thread.run</li></ul></div><!--]--></div><div class="search-page" role="search"><span class="search-close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="28" height="28" fill="currentColor"><path d="M224 416c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L224 338.8l169.4-169.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-192 192C240.4 412.9 232.2 416 224 416z"></path></svg></span><div class="gungnir-search-box"><input placeholder="$ grep ..." autocomplete="off" spellcheck="false" value><!----></div></div><div class="menu-btn-container"><div class="menu-btn-wrapper"><div class="menu-btn"><div style="" class="menu-btn-icon"><span></span><span></span><span></span></div><div style="display:none;" class="menu-text">0</div><svg class="menu-progress"><circle class="menu-border" cx="50%" cy="50%" r="48%" style="stroke-dasharray:0% 314.15926%;"></circle></svg></div><div class="menu-btn-child-wrapper"><div class="toggle-dark-button menu-btn-child" title="toggle dark mode"><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 00283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"/></svg><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.7999999999999998em;" aria-hidden="true" width="28.799999999999997" height="28.799999999999997" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg></div><div class="menu-btn-child menu-toc-btn"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M48 48a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm448 16H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16z"/></svg></div><div class="toggle-sidebar-button menu-btn-child menu-btn-sidebar" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path d="M14 2a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V3a1 1 0 011-1h12zM2 1a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2H2z"/><path d="M3 4a1 1 0 011-1h2a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg></div></div></div></div><footer class="footer"><span>
                &copy; pixel-revolve 2021-2022
                <br>
                Powered by <a href="https://vuepress.vuejs.org" target="_blank">VuePress</a> &
                <a href="https://github.com/Renovamen/vuepress-theme-gungnir" target="_blank">Gungnir</a>
                </span></footer></div><!--]--></div>
    <script type="module" src="/assets/app.9fd9aa02.js" defer></script>
  </body>
</html>
